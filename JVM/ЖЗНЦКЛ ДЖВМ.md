**JVM** **–** виртуальная машина Java, которая выполняет байт-код Java. Она предоставляет среду выполнения для Java-приложений и обеспечивает кроссплатформенность.

Жизненный цикл JVM:

1. **Загрузка** **классов** **(Class Loader Subsystem)**

В этой подсистеме существует 3 основных загрузчика:

1. **Bootstrap** **ClassLoader**. Это первичный загрузчик, который загружает стандартные библиотеки, такие как lang, util и т.д.
    
2. **Extension** **ClassLoader**. Является дочерним загрузчиком Bootstrap, который загружает классы из папки extension, который содержит различные расширения. (С Java 9 его заменил JavaPlatformModuleSystem
    

Принцип заключается в упаковке пакетов в модули и загружает оттуда необходимые классы)

3. **Application** **ClassLoader**. Является дочерним Extesion, который загружает классы из classpath, то есть пользовательские классы.
    

Загрузчики работают по принципу делегирования. При запросе на загрузку каждый загрузчик делегирует запрос родителю, если родитель не может загрузить класс, то загрузчик пытается сам загрузить класс иначе ClassNotFoundException.

2. **Linking (****Линковка)**
    

Состоит из трех этапов:

1. **Верификация**. Проверяет байт-код класса на соответсвие правилам и структуре, включает проверку корректности типов и т.д иначн VerifyError
    
2. **Подготовка**. Подготовка включает выделение памяти для статических переменных и их инициализацию.
    
3. **Разрешение зависимостей**. Происходит разрешение ссылок на другие классы методы, на которые ссылается загружаемый класс. Загрузка зависимых классов.
  

3. **Initialization**
    

Выполняется инициализация классов, вызов методов, выполнение статических блоков.

**Runtime Data Area (Собственная память JVM)**

1. **Method** **Area****.** Является частью metaspace. Облатсь памяти в которой хранятся метаданные о классах, методах, статических переменных.
    
2. **Heap**. Область памяти в которой хранятся все объекты и массивы. Делится на Young Generation и Old Generation, где молодое используются для новых данных, старое для долгоживущих. Один Heap на все потоки.
    
3. **Stack**. Стек используется для хранения локальных переменных, фреймов, ссылки на объекты в Heap. Доступ быстрее чем к куче за счет LIFO.
    
4. **PC Register (PC-регистр**): PC-регистр хранит адрес текущей выполняемой инструкции(команда JVM которая выполняется). Каждый поток выполнения имеет свой собственный PC-регистр, который создается при запуске потока.
    
5. **Native Method stack (Нативные методы)** : Данная область памяти используется для хранения информации о нативных методах, которые реализованы на других языках программирования, таких как C или C++.
    

**Execution** **Engines**

В стандарте JDK, такой как например OpenJDK, идет JIT Компилятор HotSpot, который по умолчанию начинает работать после 10 000 вызовов метода




**Сборка мусора** выполняется JVM автоматически через регулярные промежутки времени и не требует отдельной обработки. Ее также можно запустить вызовом System.gc(), но выполнение не гарантируется.

1. Serial GC (Самый первый GC)
    

Однопоточный, в начале каждого этапа сборки происходит STW пауза, которая полностью останавливает поток и начинает работать сборщик.

Малая сборка: Когда место в молодом поколении заканчивается происходит сборка мусора, выбираются живые объекты, и эти объекты переносятся в s0, остальные удаляются, во время второй сборки происходит проверка в s0 и живые объекты перносятся в s1 и так далее.

Сборка происходит типа Mark-Sweep-Compact.

Большая сборка происходит когда заполняется старшее поколение, она происходит вместе с малой.

2. **Parallel** **GC**. Принцип работы такой же только присутствует многопоточность, то есть перенос объектов в старшее поколение проиходит несколькими потоками. Работает чуть быстрее за счет многопточности.
    
3. **CMS**. Некоторые операции работают в фоновом режиме. Отсановки происходят во время меток объектов. Чистка в фоновом режиме.
    
4. **G****1**. По умолчанию с Java 9. Делит кучу на регионы, начинает сборку с самого загрязненного.
    
5. **Z** **GC**. Гарантирует паузы меньше секунды, паузы не увеличиваются с ростом кучи. Поддержка куч до 16 ТБ. Использует цветные указатели, которые содержат метаданные, о состоянии. (например подлежит удалению, либо долгоживущий объект).
    
6. **Shenondoah**. Такой же как ZGC и вместо цветных указателей, использует указатели Брукса, то есть объект хранит в себе указатели на новое место хранения.
    

-**D**: Эта опция используется для установки кастомных свойств. С помощью -D вы можете установить значения свойств, которые будут доступны в приложении через System.getProperty(). Пример: -Dmy.property=value

-**X**: Эта опция используется для управления различными параметрами JVM, такими как размер памяти, стека и т. д. Примеры: -Xmx512m (установка максимального размера кучи в 512 МБ), -Xss256k (установка размера стека потока в 256 КБ)

-**XX**: Эта опция используется для включения и настройки опций, специфичных для реализации JVM. Они предоставляют дополнительные возможности и настройки для оптимизации и отладки JVM. Пример: -XX:+UseParallelGC (использование параллельного сборщика мусора) Посмотреть какой GC используется - JINFO