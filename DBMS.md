NoSQL может использовать различные структуры данных такие как **документы (****MongoDB****), графы (****Neo****4****J****), широкие столбцы(****G** **Big****Tables), пары ключ-значение (****Redis****)**

**SQl** обычно используется в системах, где требуется строгая схемаи надежность данных. Например: финансовые системы, CRM-системы.

NoSql обычно в системах где требуется большая масштабируемость и гибкость структуры данных.

**Типы индексов:**

Для того чтобы узнать используется ли индексы, используется запрос:

**select** ***** **from** **pg****_****indexes**

Посмотреть данные запроса: **EXPLAIN**  <запрос>

**B****-****Tree****.** Работает с операциями >,<,=>.. Хорошо работает с числовыми данными, может индексировать null, использует бинарное сбалансированное дерево. O(log(n))

**Hash**. Хорошо работает с операцией “=”, так как использует хэширование значений.

**Brin**. Использует блочный подход где таблица разбивается на зоны, где для каждой зоны сохраняются метаданные об этой зоне (в табице) и просходит поиск. Полезен для работы с данными, которые имеют естественную упорядоченность, то есть работа допустим с почтовыми индексами.

**GIN** **и** **GIST** – оба хорошо используются для ускорения полнотекстового поиска, например с оператором LIKE.

**SP****-****GIST** – хорошо работает с наборами данных с естественной упорядоченностью, но не являются сбалансированными, например телефоные номера, которые кластеризуются по странам, городам и т.д, а часть номера более менее случайна.

**Уникальные индексы**, **составные индексы** (используют несколько столбцов), **частичные индексы** (определенные строки таблицы, таблица заказы, и оптимизирует запросы заказов по статусу в обработке)

  
  

**Принцип работы блокирвок**

Блокировки работают предотвращая одновременное изменение одних и тех же данных разными транзакциями. Когда транзакция хочет изменить данные, она должна сначала их заблокировать.

  
  

**Блокировки на уровне строк** **(на уровне БД)****:**

**FOR UPDATE**: Не позволяет читать и изменять да нные (Строже чем FOR SHARE, аналогично **PISSIMISTIC_WRITE**)

**FOR NO KEY UPDATE**: Почти то же самое, что и FOR UPDATE, но немного слабее. Другие люди все еще могут читать строки, пока вы работаете.

**FOR SHARE**: Блокирует запросы UPDATE, DELETE, SELECT FOR UPDATE, FOR NO KEY UPDATE (**Аналогично PESSIMISTIC_READ**)

**FOR KEY SHARE**: Это еще более слабая блокировка. Вы говорите: “Я хочу прочитать эти строки, и я не хочу, чтобы кто-то удалял их или менял ключевые значения, пока я не закончу”.

3 типа пессимистической блокировки

**SharedLock** – данные не будут изменятся другой транзакцией, однако чтение данных доступно

**ExclusiveLock** – запрещает и читать и изменять данные другой транзакцией

**UpdateLock** – запрещает обновлять данные, но позволяет читать

**Оптимистическая достигается путем версионирования**
Добавляется поле с **@Version** в сущность, и hibernate автоинкрементит значение этого поля при каждом обновлении сущности. Если версия сущности изменилась во время параллельной работы транзакции, это означает что другая транзакция уже внесла изменения, и у текущей может выбросится OptimisticLockException, требуется для предотвращения грязного чтения

**Нормализация** — это процесс организации данных в базе данных(РБД).

**1 нормальная форма.**

Каждая ячейка таблицы должна содержать одно значение.

Не должно быть дублирующих строк

В столбце хранятся значения одного типа данных

**2 нормальная форма. (быть в 1НФ)**

Должен быть первичный ключ

**3 нормальная форма. (быть во 2НФ)**

Устранить столбцы, не зависящие от первичного ключа. (создать еще одну таблицу)

Связать эти таблицы с помощью внешнего ключа

  

**MongoDB**

![[Pasted image 20240419143324.png]]
  

**Агрегация** - это процесс обработки данных, используемый в MongoDB для анализа, группировки и обработки данных в коллекции.

Она состоит из пайплайнов - это последовательности операторов, которые применяются к каждому документу, проходящему через пайплайн.

**$match** - фильтрует документы по заданному критерию

![[Pasted image 20240419143348.png]]

  
  

**Redis** — резидентная(in-memory) NoSQL субд типа «ключ — значение». Используется как для баз данных, так и для реализации кэшей. Ориентирована на достижение максимальной производительности на атомарных операциях. (Хранит базу данных в оперативной памяти, за счет этого гораздо быстрее чем реляционные бд)

Производительность: более 100 тысяч GET/SET запросов в секунду